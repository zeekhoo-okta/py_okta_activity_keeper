function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)===a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function searchOpptys(){var a=document.getElementById("searchOp"),b=new XMLHttpRequest;url="/sfdc/search/",q=a.value,q.length>=3&&(url+="?q="+q),b.open("GET",url),b.setRequestHeader("Accept","application/json"),b.setRequestHeader("Content-Type","application/json"),b.send(),b.onreadystatechange=function(){401==b.status&&(window.location.href="/sfdc/oauth/init"),null!=b.responseText&&""!=b.responseText&&(recents=JSON.parse(b.responseText),opportunities=recents.opportunities,drawTable(opportunities))}}function drawTable(a){var b,c="";for(b=0;b<a.length;b++)c+='<tr><td style="display:none">'+a[b].Id+'</td><td style="display:none">'+a[b].Name+"</td><td>"+a[b].Name+'<br><p style="font-size:11px">Owner:&nbsp;'+a[b].Owner+"&nbsp;&nbsp;Amount:&nbsp;"+a[b].Amount+'</p></td><td style="font-size:11px">'+a[b].Stage+"<br>Close:&nbsp;"+a[b].CloseDate+"</td></tr>";document.getElementById("search_results").innerHTML=c,document.getElementById("selectedOp").innerHTML="",document.getElementById("selectedOpId").innerHTML=""}function selectOp(){var a=document.getElementById("search_results");a.onclick=function(a){a=a||window.event;for(var b=a.srcElement||a.target;b&&"TR"!==b.nodeName;)b=b.parentNode;if(b){var c=b.getElementsByTagName("td"),d=c[1].innerHTML,e=c[0].innerHTML;document.getElementById("selectedOp").innerHTML='<p class="form-control-static">'+d+"</p>",document.getElementById("selectedOpId").innerHTML='<p class="form-control-static">'+e+"</p>",document.getElementById("opportunity_id").value=e,document.getElementById("search_results").innerHTML="",document.getElementById("tab_head").innerHTML=""}}}function urlParams(){var a;return(window.onpopstate=function(){var b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f=window.location.search.substring(1);for(a={};b=d.exec(f);)a[e(b[1])]=e(b[2])})(),a}function oauth2Callback(a,b){var c=getCookie("csrftoken"),d=urlParams(),e=d.code,f=new XMLHttpRequest;f.open("POST",a),f.setRequestHeader("X-CSRFToken",c),f.setRequestHeader("Content-Type","application/json;charset=UTF-8"),f.send(JSON.stringify({code:e})),f.onreadystatechange=function(){res=f.status,401==res.status_code&&(window.location.href="/login"),window.location.href=b}}function recordTask(a,b){element=document.getElementById("has_token_flag"),"1"==element.innerHTML?(xhttp.open("POST","/taskaction/"+a+"/"),xhttp.setRequestHeader("X-CSRFToken",csrftoken),xhttp.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xhttp.send(JSON.stringify({action:b})),xhttp.onreadystatechange=function(){var b=document.getElementById("row_"+a);null!=b&&b.parentNode.removeChild(b)}):(url="/sfdc/oauth/init/",window.location=url)}function dismissTask(a){console.log("dismiss task "+a),xhttp.open("DELETE","/task/"+a+"/"),xhttp.setRequestHeader("X-CSRFToken",csrftoken),xhttp.send(),xhttp.onreadystatechange=function(){var b=document.getElementById("row_"+a);null!=b&&b.parentNode.removeChild(b)}}function taskDetails(a){var b="hidden";"hidden"!=document.getElementById("desc_"+a).className?(b="col-xs-3",document.getElementById("desc_"+a).className="hidden"):document.getElementById("desc_"+a).className="x"}var has_token_flag=document.getElementById("has_token_flag"),xhttp=new XMLHttpRequest,csrftoken=getCookie("csrftoken");