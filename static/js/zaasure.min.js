function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var s=jQuery.trim(n[o]);if(s.substring(0,e.length+1)===e+"="){t=decodeURIComponent(s.substring(e.length+1));break}}return t}function urlParams(){var e;return(window.onpopstate=function(){var t,n=/\+/g,o=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(n," "))},r=window.location.search.substring(1);for(e={};t=o.exec(r);)e[s(t[1])]=s(t[2])})(),e}function oauth2Callback(e,t){var n=getCookie("csrftoken"),o=urlParams().code,s=new XMLHttpRequest;s.open("POST",e),s.setRequestHeader("X-CSRFToken",n),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(JSON.stringify({code:o})),s.onreadystatechange=function(){status=s.status,401==status&&(window.location.href="/login"),200==status&&(window.location.href=t)}}function searchOpptys(){var e=document.getElementById("searchOp"),t=new XMLHttpRequest;url="/sfdc/search/",q=e.value,q.length>=3&&(url+="?q="+q),t.open("GET",url),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send(),t.onreadystatechange=function(){401==t.status&&(window.location.href="/sfdc/oauth/init"),null!=t.responseText&&""!=t.responseText&&(recents=JSON.parse(t.responseText),opportunities=recents.opportunities,drawTable(opportunities))}}function drawTable(e){var t,n="";for(t=0;t<e.length;t++)opportunity_id="-1",null!=e[t].Id&&(opportunity_id=e[t].Id),n+='<tr><td style="display:none">'+opportunity_id+'</td><td style="display:none">'+e[t].Name+"</td><td>"+e[t].Name,null!=e[t].Owner&&(n+='<br><p style="font-size:11px">Owner:&nbsp;'+e[t].Owner+"&nbsp;&nbsp;Amount:&nbsp;"+e[t].Amount+'</p></td><td style="font-size:11px">'+e[t].Stage+"<br>Close:&nbsp;"+e[t].CloseDate+"</td>"),n+="</tr>";document.getElementById("search_results").innerHTML=n,document.getElementById("selectedOp").innerHTML="",document.getElementById("selectedOpId").innerHTML=""}function selectOp(){document.getElementById("search_results").onclick=function(e){for(var t=(e=e||window.event).srcElement||e.target;t&&"TR"!==t.nodeName;)t=t.parentNode;if(t){var n=t.getElementsByTagName("td"),o=n[0].innerHTML;if("-1"!=o){var s=n[1].innerHTML;document.getElementById("selectedOp").innerHTML='<p class="form-control-static">'+s+"</p>",document.getElementById("selectedOpId").innerHTML='<p class="form-control-static">'+o+"</p>",document.getElementById("opportunity_id").value=o,document.getElementById("search_results").innerHTML="",document.getElementById("tab_head").innerHTML=""}}}}function recordTask(e,t){element=document.getElementById("has_token_flag"),"1"==element.innerHTML?(xhttp.open("POST","/taskaction/"+e+"/"),xhttp.setRequestHeader("X-CSRFToken",csrftoken),xhttp.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xhttp.send(JSON.stringify({action:t})),xhttp.onreadystatechange=function(){var t=document.getElementById("row_"+e);null!=t&&t.parentNode.removeChild(t)}):(url="/sfdc/oauth/init/",window.location=url)}function dismissTask(e){console.log("dismiss task "+e),xhttp.open("DELETE","/task/"+e+"/"),xhttp.setRequestHeader("X-CSRFToken",csrftoken),xhttp.send(),xhttp.onreadystatechange=function(){var t=document.getElementById("row_"+e);null!=t&&t.parentNode.removeChild(t)}}function taskDetails(e){"hidden"!=document.getElementById("desc_"+e).className?("col-xs-3",document.getElementById("desc_"+e).className="hidden"):document.getElementById("desc_"+e).className="x"}var has_token_flag=document.getElementById("has_token_flag"),xhttp=new XMLHttpRequest,csrftoken=getCookie("csrftoken");